# 环境配置指南

> 本指南帮助您从零开始配置Transformer拉曼光谱混合物分析系统的运行环境

## 📋 目录

- [系统要求](#系统要求)
- [方式一：使用Miniconda（推荐）](#方式一使用miniconda推荐)
- [方式二：使用系统Python](#方式二使用系统python)
- [验证安装](#验证安装)
- [常见问题](#常见问题)
- [环境管理](#环境管理)

---

## 系统要求

### 硬件要求

- **内存**: 建议4GB以上
- **硬盘**: 至少500MB可用空间
- **GPU**: 可选（默认使用CPU）
- **处理器**: 支持x86_64架构

### 软件要求

- **操作系统**: Windows 10/11 / Linux / macOS
- **Python版本**: 3.8 - 3.11
- **CUDA版本**: 可选 - CUDA 11.7+（如需GPU加速）

---

## 方式一：使用Miniconda（推荐）

### 步骤1：安装Miniconda

**下载地址**：
- 清华镜像：https://mirrors.tuna.tsinghua.edu.cn/anaconda/miniconda/
- 官方地址：https://docs.conda.io/en/latest/miniconda.html

**选择版本**：
- Windows: `Miniconda3-latest-Windows-x86_64.exe`
- Linux: `Miniconda3-latest-Linux-x86_64.sh`
- macOS: `Miniconda3-latest-MacOSX-x86_64.sh` 或 `Miniconda3-latest-MacOSX-arm64.sh`（M系列芯片）

**安装提示**：
- Windows用户：双击安装包，按提示完成安装
- Linux/macOS用户：
```bash
bash Miniconda3-latest-*.sh
```

### 步骤2：创建虚拟环境

打开**Anaconda Prompt**（Windows）或**终端**（Linux/macOS）：

```bash
# 创建名为use的Python 3.11环境
conda create -n use python=3.11 -y

# 激活环境
conda activate use
```

### 步骤3：配置镜像源（可选，提速下载）

```bash
# 添加清华镜像
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/

# 配置pip镜像
pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
```

### 步骤4：安装依赖

```bash
# 进入项目目录（替换为您的实际路径）
cd "D:\日常事务\李老师事务\2025编书系统工程与管理工程书\2025.10\所有程序\Transformer模型"

# 优先使用conda安装主要依赖
conda install pytorch numpy matplotlib scikit-learn scipy tqdm -y

# 安装其他依赖
pip install -r requirements.txt
```

**如果需要GPU支持**：
```bash
# 安装GPU版本的PyTorch（根据您的CUDA版本选择）
conda install pytorch torchvision torchaudio pytorch-cuda=11.8 -c pytorch -c nvidia
```

---

## 方式二：使用系统Python

### 步骤1：检查Python版本

打开命令提示符或终端，检查Python版本：

```bash
python --version
```

确保版本为 3.8、3.9、3.10 或 3.11。

### 步骤2：创建虚拟环境（推荐）

```bash
# 进入项目目录
cd "D:\日常事务\李老师事务\2025编书系统工程与管理工程书\2025.10\所有程序\Transformer模型"

# 创建虚拟环境
python -m venv venv
```

### 步骤3：激活环境

**Windows**:
```bash
venv\Scripts\activate
```

**Linux/macOS**:
```bash
source venv/bin/activate
```

### 步骤4：安装依赖

```bash
# 升级pip（推荐）
python -m pip install --upgrade pip

# 安装依赖
pip install -r requirements.txt
```

---

## 验证安装

运行快速测试程序：

```bash
# 确保已激活环境
conda activate use

# 运行快速开始脚本
python quick_start.py
```

**预期输出**：
```
欢迎使用Transformer拉曼光谱混合物分析系统
使用设备: cpu

================================================================================
1. 数据生成演示
================================================================================

生成的数据:
  光谱形状: (10, 1738)
  成分标签形状: (10, 5)
  浓度形状: (10, 5)
  ...
```

### 验证关键库

```bash
# 验证PyTorch
python -c "import torch; print('PyTorch版本:', torch.__version__)"

# 验证NumPy
python -c "import numpy; print('NumPy版本:', numpy.__version__)"

# 验证其他库
python -c "import matplotlib, sklearn, scipy; print('依赖安装成功')"

# 验证CUDA（如果使用GPU）
python -c "import torch; print('CUDA可用:', torch.cuda.is_available())"
```

---

## 常见问题

### Q1: conda命令不可用

**现象**：
```
'conda' 不是内部或外部命令
```

**解决方案**：
1. 重启命令提示符/终端
2. 或者使用**Anaconda Prompt**（Windows开始菜单中搜索）
3. 或者手动添加Miniconda到PATH环境变量

### Q2: 安装依赖时出现网络错误

**现象**：
```
ReadTimeoutError: HTTPSConnectionPool...
```

**解决方案**：
```bash
# 配置pip镜像源
pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple

# 或使用临时镜像
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### Q3: PyTorch安装失败

**解决方案**：
访问PyTorch官网获取适合您系统的安装命令：
https://pytorch.org/get-started/locally/

**示例命令**：
```bash
# CPU版本
conda install pytorch torchvision torchaudio cpuonly -c pytorch

# CUDA 11.8版本
conda install pytorch torchvision torchaudio pytorch-cuda=11.8 -c pytorch -c nvidia
```

### Q4: 权限不足

**Windows系统**：
- 以管理员身份运行命令提示符

**Linux/macOS系统**：
```bash
# 不要使用sudo安装到虚拟环境
# 确保虚拟环境已激活
conda activate use
pip install -r requirements.txt
```

### Q5: 中文显示乱码

**解决方案**：
已在代码中配置中文字体，如果仍有问题：

```python
import matplotlib.pyplot as plt
plt.rcParams['font.sans-serif'] = ['SimHei', 'Microsoft YaHei', 'DejaVu Sans']
plt.rcParams['axes.unicode_minus'] = False
```

---

## 环境管理

### 常用命令

```bash
# 激活环境
conda activate use

# 退出环境
conda deactivate

# 查看已安装的包
conda list

# 查看所有环境
conda env list

# 删除环境（如需重新配置）
conda remove -n use --all

# 导出环境配置
conda env export > environment.yml

# 从配置文件创建环境
conda env create -f environment.yml
```

### 更新依赖

```bash
# 更新单个包
conda update numpy

# 更新所有包
conda update --all
```

### 环境备份

```bash
# 导出requirements
pip freeze > requirements_backup.txt

# 导出conda环境
conda env export > environment_backup.yml
```

---

## 下一步

环境配置完成后，请阅读 **[使用指南.md](使用指南.md)** 了解如何使用本项目。

---

## 技术支持

**遇到问题？**
1. 查看本文档的"常见问题"章节
2. 阅读项目README.md
3. 检查`logs/`目录下的日志文件
4. 确保Python版本在3.8-3.11范围内

**验证清单**：
- [ ] Python版本正确（3.8-3.11）
- [ ] 虚拟环境已创建并激活
- [ ] 所有依赖包已安装
- [ ] quick_start.py能够成功运行
- [ ] 没有报错信息

---

**配置完成！祝您使用愉快！** 🎉

